<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Nunito:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="style.css"><title>Dr. Strangetest, a PHP testing framework</title></head><body><header><h1>Dr. Strangetest</h1><p id="subtitle">Or: How I Learned To Stop Worrying And Test The Code</p><p id="tagline">A testing framework for PHP</p><nav><ul id="navbar"><li><a href=".">Home</a></li><li><a href="documentation.html" class="active">Documentation</a></li><li><a href="contributing.html">Contributing</a></li></ul></nav></header><main><nav id="doc-toc"><ol><li class="collapsible"><input type="checkbox"><a href="getting-started.html">Getting Started</a><ol><li><a href="getting-started.html#requirements">Requirements</a></li><li class="collapsible"><input type="checkbox"><a href="getting-started.html#installation">Installation</a><ol><li><a href="getting-started.html#phar-php-archive">Phar (PHP Archive)</a></li><li><a href="getting-started.html#composer">Composer</a></li></ol></li><li><a href="getting-started.html#verifying-installation">Verifying Installation</a></li></ol></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html">Writing Tests</a><ol><li><a href="writing-tests.html#what-is-a-test">What is a Test?</a></li><li><a href="writing-tests.html#making-assertions">Making Assertions</a></li><li><a href="writing-tests.html#testing-exceptions-and-errors">Testing Exceptions and Errors</a></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html#skipping-tests">Skipping Tests</a><ol><li><a href="writing-tests.html#skipping-a-test">Skipping a Test</a></li><li><a href="writing-tests.html#viewing-skipped-tests">Viewing Skipped Tests</a></li></ol></li><li><a href="writing-tests.html#subtests">Subtests</a></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html#test-dependencies">Test Dependencies</a><ol><li><a href="writing-tests.html#declaring-dependencies">Declaring Dependencies</a></li><li><a href="writing-tests.html#setting-a-test-result">Setting a Test Result</a></li><li><a href="writing-tests.html#specifying-test-names">Specifying Test Names</a></li><li><a href="writing-tests.html#depending-on-tests-with-subtests">Depending on Tests with Subtests</a></li><li><a href="writing-tests.html#depending-on-tests-that-are-run-multiple-times">Depending on Tests That Are Run Multiple Times</a></li></ol></li></ol></li><li class="collapsible"><input type="checkbox"><a href="test-fixtures.html">Test Fixtures</a><ol><li class="collapsible"><input type="checkbox"><a href="test-fixtures.html#fixture-functions">Fixture Functions</a><ol><li><a href="test-fixtures.html#test-specific-teardown">Test-Specific Teardown</a></li><li><a href="test-fixtures.html#method-setup-and-teardown">Method Setup and Teardown</a></li><li><a href="test-fixtures.html#object-setup-and-teardown">Object Setup and Teardown</a></li><li><a href="test-fixtures.html#function-setup-and-teardown">Function Setup and Teardown</a></li><li><a href="test-fixtures.html#file-setup-and-teardown">File Setup and Teardown</a></li><li><a href="test-fixtures.html#directory-setup-and-teardown">Directory Setup and Teardown</a></li></ol></li><li><a href="test-fixtures.html#managing-resources">Managing Resources</a></li><li><a href="test-fixtures.html#providing-state-to-tests">Providing State to Tests</a></li><li><a href="test-fixtures.html#running-tests-multiple-times">Running Tests Multiple Times</a></li></ol></li><li class="collapsible"><input type="checkbox" checked>Writing Assertions<ol><li><a href="#custom-assertion-functions">Custom Assertion Functions</a></li><li><a href="#a-comprehensive-example">A Comprehensive Example</a></li><li><a href="#please-contribute">Please Contribute!</a></li></ol></li></ol></nav><article><h2 id="writing-assertions">Writing Assertions</h2><h3 id="custom-assertion-functions">Custom Assertion Functions</h3><p>An assertion is just a function (or a method) that, upon failure, throws an instance of <code>easytest\Failure</code> or, in PHP 7, an instance of <code>AssertionError</code>. You might also begin the function name with <code>assert</code>, but this is optional.</p><p>In the simplest case, you may just want to write a function that wraps PHP's <code>assert</code> or another EasyTest assertion. In more complex cases, you can implement your assertion logic manually, which generally boils down to:</p><ol><li><p>Check if the assertion passes or fails. This can consist of arbitrarily complex logic that ultimately depends on the outcome of a conditional expression. If the expression is true, the assertion passes, otherwise it fails. If the assertion fails, then:</p></li><li><p>Create a failure message. EasyTest offers some functions (described in the <a href="https://github.com/gnarlyquack/easytest">README</a>) to help with creating informative failure messages. There is no requirement to use them, but they are used by EasyTest itself and provided as part of the framework.</p></li><li><p>Throw a failure exception. EasyTest provides <code>easytest\fail</code>, which just takes a message and throws a failure exception. The exception it throws is compatible with EasyTest regardless of the version of PHP in use.</p></li></ol><h3 id="a-comprehensive-example">A Comprehensive Example</h3><p>Here is an implementation of <code>assert_identical</code>:</p><div class="highlight"><pre><span></span><code><span class="k">function</span> <span class="nf">assert_identical</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nv">$msg</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$expected</span> <span class="o">===</span> <span class="nv">$actual</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$assertion</span> <span class="o">=</span> <span class="s1">&#39;Assertion &quot;$expected === $actual&quot; failed&#39;</span><span class="p">;</span>
    <span class="nv">$detail</span> <span class="o">=</span> <span class="nx">easytest\diff</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">,</span> <span class="s1">&#39;$expected&#39;</span><span class="p">,</span> <span class="s1">&#39;$actual&#39;</span><span class="p">);</span>

    <span class="nv">$reason</span> <span class="o">=</span> <span class="nx">easytest\format_failure_message</span><span class="p">(</span><span class="nv">$assertion</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$detail</span><span class="p">);</span>
    <span class="nx">easytest\fail</span><span class="p">(</span><span class="nv">$reason</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Let's consider the following call to the above function:</p><div class="highlight"><pre><span></span><code><span class="nx">assert_identical</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;I failed? :-(&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Since <code>1 === '1'</code> is false, the conditional expression and thus the assertion as a whole fails. We'd like to provide some indication of the assertion that failed, so we represent the assertion expression as a string:</p><div class="highlight"><pre><span></span><code><span class="nv">$assertion</span> <span class="o">=</span> <span class="s1">&#39;Assertion &quot;$expected === $actual&quot; failed&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Now we'd like to show why <code>$expected</code> and <code>$actual</code> aren't identical, and so we generate a diff between the values. In this case it's rather obvious, and it might be tempting to just inline the values into the assertion expression string. However, if multiline strings or composite data types are involved, showing a diff makes it much easier to determine why the two values differ. The result is:</p><div class="highlight"><pre><span></span><code><span class="nv">$detail</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">DIFF</span><span class="s">&#39;</span>
<span class="s">- $expected</span>
<span class="s">+ $actual</span>

<span class="s">- 1</span>
<span class="s">+ &#39;1&#39;</span>
<span class="dl">DIFF</span><span class="p">;</span>
</code></pre></div>
<p>The strings (<b>not</b> the variables!) <code>'$expected'</code> and <code>'$actual'</code> are passed into <code>easytest\diff</code> to generate the first two lines of the diff.</p><p>Now we stitch together a final message using <code>$assertion</code>, <code>$msg</code>, and <code>$detail</code>. <code>easytest\format_failure_message</code> tries remove the drudgery in this, since <code>$msg</code> may be blank and/or our assertion may be simple enough we don't want to generate a detail. The resulting <code>$reason</code> looks like:</p><div class="highlight"><pre><span></span><code><span class="nv">$reason</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">REASON</span><span class="s">&#39;</span>
<span class="s">Assertion &quot;$expected === $actual&quot; failed</span>
<span class="s">I failed? :-(</span>

<span class="s">- $expected</span>
<span class="s">+ $actual</span>

<span class="s">- 1</span>
<span class="s">+ &#39;1&#39;</span>
<span class="dl">REASON</span><span class="p">;</span>
</code></pre></div>
<p>If any argument to <code>easytest\format_failure_message</code> is omitted, it's omitted in the final message.</p><p>Finally, we use this message with <code>easytest\fail</code> to signal failure:</p><div class="highlight"><pre><span></span><code><span class="nx">easytest\fail</span><span class="p">(</span><span class="nv">$reason</span><span class="p">);</span>
</code></pre></div>
<h3 id="please-contribute">Please Contribute!</h3><p>EasyTest's assertions cover the basics but aren't comprehensive by any means. If you feel there's an assertion that should really be included with the framework, please open an issue and (ideally) contribute a pull request!</p></article></main><footer><p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/80x15.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p><p>Please open an issue if you find an error in these pages. Fixes are also welcome!</p></footer></body></html>
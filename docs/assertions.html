<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Nunito:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="style.css"><title>Dr. Strangetest, a PHP testing framework</title></head><body><header><h1>Dr. Strangetest</h1><p id="subtitle">Or: How I Learned To Stop Worrying And Test The Code</p><p id="tagline">A testing framework for PHP</p><nav><ul id="navbar"><li><a href=".">Home</a></li><li><a href="documentation.html" class="active">Documentation</a></li><li><a href="contributing.html">Contributing</a></li></ul></nav></header><main><nav id="doc-toc"><ol><li class="collapsible"><input type="checkbox"><a href="getting-started.html">Getting Started</a><ol><li><a href="getting-started.html#requirements">Requirements</a></li><li class="collapsible"><input type="checkbox"><a href="getting-started.html#installation">Installation</a><ol><li><a href="getting-started.html#phar-php-archive">Phar (PHP Archive)</a></li><li><a href="getting-started.html#composer">Composer</a></li></ol></li><li><a href="getting-started.html#verifying-installation">Verifying Installation</a></li></ol></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html">Writing Tests</a><ol><li><a href="writing-tests.html#what-is-a-test">What is a Test?</a></li><li><a href="writing-tests.html#making-assertions">Making Assertions</a></li><li><a href="writing-tests.html#testing-exceptions-and-errors">Testing Exceptions and Errors</a></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html#skipping-tests">Skipping Tests</a><ol><li><a href="writing-tests.html#skipping-a-test">Skipping a Test</a></li><li><a href="writing-tests.html#viewing-skipped-tests">Viewing Skipped Tests</a></li></ol></li><li><a href="writing-tests.html#subtests">Subtests</a></li><li class="collapsible"><input type="checkbox"><a href="writing-tests.html#test-dependencies">Test Dependencies</a><ol><li><a href="writing-tests.html#declaring-dependencies">Declaring Dependencies</a></li><li><a href="writing-tests.html#setting-a-test-result">Setting a Test Result</a></li><li><a href="writing-tests.html#specifying-test-names">Specifying Test Names</a></li><li><a href="writing-tests.html#depending-on-tests-with-subtests">Depending on Tests with Subtests</a></li><li><a href="writing-tests.html#depending-on-tests-that-are-run-multiple-times">Depending on Tests That Are Run Multiple Times</a></li></ol></li></ol></li><li class="collapsible"><input type="checkbox"><a href="test-fixtures.html">Test Fixtures</a><ol><li class="collapsible"><input type="checkbox"><a href="test-fixtures.html#fixture-functions">Fixture Functions</a><ol><li><a href="test-fixtures.html#test-specific-teardown">Test-Specific Teardown</a></li><li><a href="test-fixtures.html#method-setup-and-teardown">Method Setup and Teardown</a></li><li><a href="test-fixtures.html#object-setup-and-teardown">Object Setup and Teardown</a></li><li><a href="test-fixtures.html#function-setup-and-teardown">Function Setup and Teardown</a></li><li><a href="test-fixtures.html#file-setup-and-teardown">File Setup and Teardown</a></li><li><a href="test-fixtures.html#directory-setup-and-teardown">Directory Setup and Teardown</a></li></ol></li><li><a href="test-fixtures.html#managing-resources">Managing Resources</a></li><li><a href="test-fixtures.html#providing-state-to-tests">Providing State to Tests</a></li><li><a href="test-fixtures.html#running-tests-multiple-times">Running Tests Multiple Times</a></li></ol></li><li class="collapsible"><input type="checkbox" checked>Assertions<ol><li><a href="#phps-assert">PHP's assert</a></li><li class="collapsible"><input type="checkbox" checked><a href="#dr-strangetests-assertions">Dr. Strangetest's Assertions</a><ol><li><a href="#assert_different">assert_different</a></li><li><a href="#assert_equal">assert_equal</a></li><li><a href="#assert_false">assert_false</a></li><li><a href="#assert_falsy">assert_falsy</a></li><li><a href="#assert_greater">assert_greater</a></li><li><a href="#assert_greater_or_equal">assert_greater_or_equal</a></li><li><a href="#assert_identical">assert_identical</a></li><li><a href="#assert_less">assert_less</a></li><li><a href="#assert_less_or_equal">assert_less_or_equal</a></li><li><a href="#assert_throws">assert_throws</a></li><li><a href="#assert_true">assert_true</a></li><li><a href="#assert_truthy">assert_truthy</a></li><li><a href="#assert_unequal">assert_unequal</a></li><li><a href="#fail">fail</a></li></ol></li><li class="collapsible"><input type="checkbox" checked><a href="#writing-custom-assertions">Writing Custom Assertions</a><ol><li class="collapsible"><input type="checkbox" checked><a href="#creating-failure-messages">Creating Failure Messages</a><ol><li><a href="#formatting-variables">Formatting Variables</a></li><li><a href="#generating-diffs">Generating Diffs</a></li><li><a href="#formatting-messages">Formatting Messages</a></li></ol></li><li><a href="#a-comprehensive-example">A Comprehensive Example</a></li></ol></li></ol></li></ol></nav><article><h2 id="assertions">Assertions</h2><p>If a particular test is supposed to produced a particular outcome, assertions are how you verify that outcome. This chapter details the various ways you can make assertions in Dr. Strangetest.</p><h3 id="phps-assert">PHP's assert</h3><p>The simplest way to make an assertion is to use PHP's built-in <code>assert</code> function. The benefit is that you can make any arbitrary assertion in your tests. The downside is that PHP typically provides limited information when an assertion fails. For that reason, you may prefer to use one of <a href="#dr-strangetests-assertions">Dr. Strangetest's assertions</a> or <a href="#writing-custom-assertions">write your own</a>.</p><p>The behavior of PHP's built-in <code>assert</code> function has changed a fair bit over the various versions of PHP, making consistent, backwards-compatible use difficult. An overview of these changes and some recommendations are provided here.</p><div class="highlight"><pre><span></span><code><span class="nb">assert</span><span class="p">(</span><span class="nx">mixed</span> <span class="nv">$assertion</span><span class="p">,</span> <span class="nx">string</span><span class="o">|</span><span class="nx">Throwable</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
</code></pre></div>
<p><code>$assertion</code> is an expression to be tested by <code>assert</code>. The assertion passes if the expression is truthy, otherwise it fails.</p><p><code>$description</code> should explain why the assertion failed and is included in the test report if the assertion fails. This parameter was added in PHP 5.4.8.</p><p>Although <code>assert</code> technically returns a boolean, Dr. Strangetest configures PHP's assertion behavior so that a failed assertion causes an exception to be thrown. In PHP 7 and higher, this exception is an instance of <code>AssertionError</code>, and in PHP 5, it's an instance of <code>strangetest\Failure</code>.</p><p>Although <code>$assertion</code> can be any expression, PHP 5 and 7 treat strings specially: the string is evaluated as PHP code, the result of which determines if the assertion passes. This behavior was deprecated in PHP 7.2 and removed in PHP 8. In PHP 5, you might prefer using a string for <code>$assertion</code>, otherwise the expression will not be displayed if the assertion fails.</p><p>In PHP 7 and higher, if the <code>assert.exception</code> configuration option is enabled and <code>$description</code> is an instance of an exception, the exception is thrown if the assertion fails. Dr. Strangetest supports this, but unless the exception is an instance of <code>AssertionError</code>, the test result is reported as an error instead of a failure. If <code>assert.exception</code> is disabled, the exception is instead converted to a string and used as the failure message.</p><h3 id="dr-strangetests-assertions">Dr. Strangetest's Assertions</h3><p>Dr. Strangetest provides the following assertions. These assertions may give better diagnostics than PHP's <code>assert</code> when they fail, but of course, the assertions you can make are limited to what is listed here. You can always <a href="#writing-custom-assertions">write your own</a> if you need custom behavior.</p><p>All assertions behave similarly: if the condition that an individual assertion is supposed to check is met, the assertion passes. Otherwise, an exception is thrown signalling an assertion failure. Unless otherwise noted, each assertion takes an optional <code>$description</code> argument that is included in the test report if the assertion fails.</p><h4 id="assert_different">assert_different</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_different</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$expected</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$expected !== $actual</code>.</p><h4 id="assert_equal">assert_equal</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_equal</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$expected</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$expected == $actual</code>.</p><h4 id="assert_false">assert_false</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_false</span><span class="p">(</span><span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual === false</code>.</p><h4 id="assert_falsy">assert_falsy</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_falsy</span><span class="p">(</span><span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual == false</code>.</p><h4 id="assert_greater">assert_greater</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_greater</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$min</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual &gt; $min</code>.</p><h4 id="assert_greater_or_equal">assert_greater_or_equal</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_greater_or_equal</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$min</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual &gt;= $min</code>.</p><h4 id="assert_identical">assert_identical</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_identical</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$expected</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$expected === $actual</code>.</p><h4 id="assert_less">assert_less</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_less</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$max</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual &lt; $max</code>.</p><h4 id="assert_less_or_equal">assert_less_or_equal</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_less_or_equal</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$max</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual &lt;= $max</code>.</p><h4 id="assert_throws">assert_throws</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_throws</span><span class="p">(</span>
    <span class="nx">string</span> <span class="nv">$exception</span><span class="p">,</span>
    <span class="nx">callable</span> <span class="nv">$callback</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">Throwable</span>
</code></pre></div>
<p>Passes if invoking <code>$callable</code> throws an exception that is an instance of <code>$exception</code>. The exception instance is returned. Any other exception is an error and is rethrown.</p><p>Fails if invoking <code>$callable</code> does not throw an exception.</p><h4 id="assert_true">assert_true</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_true</span><span class="p">(</span><span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual === true</code>.</p><h4 id="assert_truthy">assert_truthy</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_truthy</span><span class="p">(</span><span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$actual == true</code>.</p><h4 id="assert_unequal">assert_unequal</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\assert_unequal</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$expected</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
</code></pre></div>
<p>Passes if <code>$expected != $actual</code>.</p><h4 id="fail">fail</h4><div class="highlight"><pre><span></span><code><span class="nx">strangetest\fail</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$reason</span><span class="p">)</span><span class="o">:</span> <span class="nx">never</span>
</code></pre></div>
<p>Unconditionally fail. <code>$reason</code> is required.</p><h3 id="writing-custom-assertions">Writing Custom Assertions</h3><p>You may find yourself wanting to write your own assertions if you want diagnostics for a particular assertion failure that's different than what you can obtain from PHP's <code>assert</code> or Dr. Strangetest's assertions. An assertion is just a function or a method that, upon failure, throws an instance of <code>AssertionError</code> (in PHP 7 and higher) or <code>strangetest\Failure</code> (in PHP 5). You might also begin the function name with <code>assert</code>, but this is optional.</p><p>In the simplest case, you might just write a function that wraps PHP's <code>assert</code> or another Dr. Strangetest assertion. In more complex cases, you might implement your assertion logic manually, which generally boils down to:</p><ol><li><p><b>Check if the assertion passes or fails.</b> This can consist of arbitrarily complex logic that ultimately depends on the outcome of an expression. If the expression is true, the assertion passes, otherwise it fails. If the assertion fails, then:</p></li><li><p><b>Create a failure message.</b> This is typically the bulk of an assertion's work, and is a custom assertion's raison d'être. Dr. Strangetest offers functions to help <a href="#creating-failure-messages">create informative failure messages</a> that are used by the framework itself.</p></li><li><p><b>Throw a failure exception.</b> As previously noted, this exception should be an instance of <code>AssertionError</code> (in PHP 7 and higher) or <code>strangetest\Failure</code> (in PHP 5). You can use <a href="#fail"><code>strangetest\fail</code></a> as a convenience function, which just takes a message and throws an appropriate failure exception for the version of PHP being used.</p></li></ol><h4 id="creating-failure-messages">Creating Failure Messages</h4><p>Providing informative output about why an assertion failed can greatly increase an assertion's usefulness. Consequently, it's often worth the effort to create a good failure message. What's "good", however, may largely depend on context.</p><p>The elements and considerations that typically go into a good failure message include:</p><ul><li><p><b>Show the expression that failed.</b> In general, it's probably advisable to show the expression as actual PHP code to be maximally explicit about the condition that failed. That said, you might find that describing it in natural language might be more concise. E.g., <code>Assertion "in_array($value, $array)" failed</code> versus <code>Failed asserting value is in array</code>.</p></li><li><p><b>Show how the expected and actual values differ.</b> You will want to format the variables used in the assertion in a user-friendly way. What is most "friendly" can be fairly subjective and context-dependent.</p><p>Considering the above <code>in_array</code> example, you almost certainly want to show the value that was expected to be in the array. Should you also show the array? The initial instinct might be "yes!", but if the structure or content of the array is known, showing the entire array might be mostly extraneous information. The answer might also depend on if it's possible an incorrect value might have been added or if you're only concerned about whether a value was added or not. The expected size or values of the array might also impact how -- or if -- you want it shown.</p><p>It might be tempting to display the values "inline" in the expression, but if an expression's input values are relatively unconstrained, this probably won't scale well for large and/or composite values. If <code>$value = 4</code> and <code>$array = [1, 3, 5]</code>, it might be convenient to show <code>Assertion "in_array(4, [1, 3, 5])" failed</code>, but consider the result if looking for a url in a list of urls. Inlining can also result in information loss: compare what's conveyed by <code>4 === 3</code> versus <code>$expected === $actual</code> with the values of <code>$expected</code> and <code>$actual</code> shown separately.</p><p>It's possible there may be no one solution that adequately meets all use cases. In these situations, it might be best to implement multiple, context-specific assertions.</p></li><li><p><b>Allow a user-provided string to elaborate on the failure.</b> Especially if a test contains multiple (similar) assertions, it can be helpful to let the caller provide an explanatory description that's included in the failure message.</p></li></ul><p>Given all these consideration, Dr. Strangetest provides the following functions to help with generating informative failure messages.</p><h5 id="formatting-variables">Formatting Variables</h5><p>Although PHP provides several functions to format values as user-readable strings, they seem to all have tradeoffs in how they handle certain types of variables -- especially recursive ones -- and their legibility of output. For this reason, Dr. Strangetest provides a variable-formatting function that you might prefer over PHP's built-in ones.</p><div class="highlight"><pre><span></span><code><span class="nx">strangetest\format_variable</span><span class="p">(</span><span class="nx">mixed</span> <span class="o">&amp;</span><span class="nv">$variable</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</code></pre></div>
<p><code>$variable</code> is the variable to format. This is received as a reference in order to detect recursive values.</p><p>A human-readable string representation of <code>$variable</code> is returned.</p><h5 id="generating-diffs">Generating Diffs</h5><p>Generating a diff is a common way to show how two values differ, especially if the values being compared are composite values and/or multi-line strings. Showing a diff in these situations is useful because the diff will identify the specific parts of the value that are different.</p><div class="highlight"><pre><span></span><code><span class="nx">strangetest\diff</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="o">&amp;</span><span class="nv">$from</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="o">&amp;</span><span class="nv">$to</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$from_id</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$to_id</span><span class="p">,</span>
    <span class="nx">bool</span> <span class="nv">$loose</span> <span class="o">=</span> <span class="k">false</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</code></pre></div>
<p><code>$from</code> and <code>$to</code> are the values to compare. These are received as references to detect recursive values.</p><p><code>$from_id</code> and <code>$to_id</code> are used in the generated diff to identify <code>$from</code> and <code>$to</code>, respectively.</p><p><code>$loose</code> determines the type of comparison to use when generating the diff. If <code>true</code>, the diff is generated using loose comparison (<code>==</code>), otherwise strict comparison (<code>===</code>) is used.</p><p>The return value is the resulting diff formatted as a string. <code>strangetest\format_variable</code> is used to help generate the string.</p><h5 id="formatting-messages">Formatting Messages</h5><p>If you structure your assertion failure messages as <a href="#creating-failure-messages">described above</a>, you might find yourself with various string components from which you want to compose a failure message. Dr. Strangetest provides a function to streamline this process.</p><div class="highlight"><pre><span></span><code><span class="nx">strangetest\format_failure_message</span><span class="p">(</span>
    <span class="nx">string</span> <span class="nv">$assertion</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$detail</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
</code></pre></div>
<p><code>$assertion</code> is used as the first line and should generally be a string indicating the assertion expression that failed.</p><p><code>$description</code>, if provided and not empty, is used on the next line and should generally provide a context in which the <code>$assertion</code> failed.</p><p><code>$detail</code>, if provided and not empty, is double-spaced after the previous line and should generally provide more detailed information about why <code>$assertion</code> failed. You might use this to display the value of variables used within the assertion expression.</p><p>The return value is a string that combines the arguments as described above.</p><h4 id="a-comprehensive-example">A Comprehensive Example</h4><p>As an example of how to implement your own assertion function and use Dr. Strangetest's message formatting functions, here is a sample implementation of <code>assert_identical</code>:</p><div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="k">function</span> <span class="nf">strangetest\diff</span><span class="p">;</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">strangetest\fail</span><span class="p">;</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">strangetest\format_failure_message</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">assert_identical</span><span class="p">(</span>
    <span class="nx">mixed</span> <span class="nv">$expected</span><span class="p">,</span>
    <span class="nx">mixed</span> <span class="nv">$actual</span><span class="p">,</span>
    <span class="nx">string</span> <span class="nv">$description</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$expected</span> <span class="o">===</span> <span class="nv">$actual</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$assertion</span> <span class="o">=</span> <span class="s1">&#39;Assertion &quot;$expected === $actual&quot; failed&#39;</span><span class="p">;</span>
    <span class="nv">$detail</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">,</span> <span class="s1">&#39;$expected&#39;</span><span class="p">,</span> <span class="s1">&#39;$actual&#39;</span><span class="p">);</span>

    <span class="nv">$reason</span> <span class="o">=</span> <span class="nx">format_failure_message</span><span class="p">(</span><span class="nv">$assertion</span><span class="p">,</span> <span class="nv">$description</span><span class="p">,</span> <span class="nv">$detail</span><span class="p">);</span>
    <span class="nx">fail</span><span class="p">(</span><span class="nv">$reason</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Consider the following call to this function:</p><div class="highlight"><pre><span></span><code><span class="nx">assert_identical</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;I failed? :-(&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Since <code>1 === '1'</code> is false, the conditional expression and thus the assertion as a whole fails. We'd like to provide some indication of the assertion that failed, so we represent the assertion expression as a string:</p><div class="highlight"><pre><span></span><code><span class="nv">$assertion</span> <span class="o">=</span> <span class="s1">&#39;Assertion &quot;$expected === $actual&quot; failed&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Now we'd like to show why <code>$expected</code> and <code>$actual</code> aren't identical, and so we generate a diff between the values. In this case it's rather obvious, and it might be tempting to just inline the values into the assertion expression string. However, if multiline strings or composite data types are involved, showing a diff makes it much easier to determine why the two values differ. The result is:</p><div class="highlight"><pre><span></span><code><span class="nv">$detail</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">DIFF</span><span class="s">&#39;</span>
<span class="s">- $expected</span>
<span class="s">+ $actual</span>

<span class="s">- 1</span>
<span class="s">+ &#39;1&#39;</span>
<span class="dl">DIFF</span><span class="p">;</span>
</code></pre></div>
<p>The strings (<b>not</b> the variables!) <code>'$expected'</code> and <code>'$actual'</code> are passed as <code>$from_id</code> and <code>$to_id</code> into <code>strangetest\diff</code> to generate the first two lines of the diff.</p><p>Now we stitch together a final message using <code>$assertion</code>, <code>$description</code> (which was provided by the caller of the function), and <code>$detail</code>. <code>strangetest\format_failure_message</code> tries remove the drudgery in this, since <code>$description</code> may be blank and/or our assertion may be simple enough we don't want to generate a detail. The resulting <code>$reason</code> looks like:</p><div class="highlight"><pre><span></span><code><span class="nv">$reason</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">REASON</span><span class="s">&#39;</span>
<span class="s">Assertion &quot;$expected === $actual&quot; failed</span>
<span class="s">I failed? :-(</span>

<span class="s">- $expected</span>
<span class="s">+ $actual</span>

<span class="s">- 1</span>
<span class="s">+ &#39;1&#39;</span>
<span class="dl">REASON</span><span class="p">;</span>
</code></pre></div>
<p>If any argument to <code>strangetest\format_failure_message</code> is omitted, it's omitted in the final message.</p><p>Finally, we use this message with <code>strangetest\fail</code> to signal failure:</p><div class="highlight"><pre><span></span><code><span class="nx">strangetest\fail</span><span class="p">(</span><span class="nv">$reason</span><span class="p">);</span>
</code></pre></div>
</article></main><footer><p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/80x15.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p><p>Please open an issue if you find an error in these pages. Fixes are also welcome!</p></footer></body></html>